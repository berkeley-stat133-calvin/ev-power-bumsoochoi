<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brian Choi">

<title>EV Power - Lab 4 Project Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="report_files/libs/clipboard/clipboard.min.js"></script>
<script src="report_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="report_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="report_files/libs/quarto-html/popper.min.js"></script>
<script src="report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report_files/libs/quarto-html/anchor.min.js"></script>
<link href="report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="report_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="report_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="report_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="report_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="report_files/libs/leaflet-1.3.1/leaflet.js"></script>
<link href="report_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="report_files/libs/proj4-2.6.2/proj4.min.js"></script>
<script src="report_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="report_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="report_files/libs/leaflet-binding-2.2.3/leaflet.js"></script>
<script src="report_files/libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="report_files/libs/leaflet-providers-plugin-2.2.3/leaflet-providers-plugin.js"></script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EV Power - Lab 4 Project Report</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brian Choi </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="example-solution-1" class="level1">
<h1>Example Solution 1</h1>
<section id="part-0-libraries" class="level2">
<h2 class="anchored" data-anchor-id="part-0-libraries"><strong>Part 0: libraries</strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(usmap)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-1-defining-research-question" class="level2">
<h2 class="anchored" data-anchor-id="part-1-defining-research-question"><strong>Part 1:</strong> <strong>Defining Research Question</strong></h2>
<p>Chosen Question: * What is the average growth in renewable energy and non-renewable energy across different states and energy sources from 2023-2021? * Which states led the highest growth in either categories? * What energy sources had the largest change in usage from 2021-2023?</p>
</section>
<section id="part-2-data-preparation-and-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="part-2-data-preparation-and-cleaning"><strong>Part 2: Data Preparation and Cleaning</strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## import all data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>avg_price <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/av-energy-price-2021-2023.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ev_registration <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/ev-registrations-by-state-2023.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
â€¢ `` -&gt; `...2`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>renew_use_2021 <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/renew-use-2021.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>renew_use_2022 <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/renew-use-2022.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>renew_use_2023 <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/renew-use-2023.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>total_use_2021 <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/total-use-2021.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>total_use_2022 <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/total-use-2022.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>total_use_2023 <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/total-use-2023.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename function</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>energy_source_rename <span class="ot">=</span> <span class="cf">function</span>(df){</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    source <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Coal'</span>,<span class="st">'Natural Gas'</span>,<span class="st">'Petroleum'</span>,<span class="st">'Nuclear Energy'</span>,<span class="st">'Total Renewable Energy'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'Energy_Source'</span>] <span class="ot">=</span> source</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize name for all three dfs</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>total_use_2021 <span class="ot">=</span> <span class="fu">energy_source_rename</span>(total_use_2021)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>total_use_2022 <span class="ot">=</span> <span class="fu">energy_source_rename</span>(total_use_2022)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>total_use_2023 <span class="ot">=</span> <span class="fu">energy_source_rename</span>(total_use_2023)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract digit function</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>extract_digit <span class="ot">=</span> <span class="cf">function</span>(df, column, pattern){</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> df<span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            <span class="do">## syntax for dynamically creating a new column</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="sc">!!</span>{{column}} <span class="sc">:</span><span class="er">=</span> <span class="fu">str_extract</span>(df[[{{column}}]], pattern)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>renew_use_2021 <span class="ot">=</span> <span class="fu">extract_digit</span>(renew_use_2021, <span class="st">"Renewable_Use_2021"</span> , <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>renew_use_2022 <span class="ot">=</span> <span class="fu">extract_digit</span>(renew_use_2022, <span class="st">"Renewable_Use_2022"</span> , <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>renew_use_2023 <span class="ot">=</span> <span class="fu">extract_digit</span>(renew_use_2023, <span class="st">"Renewable_Use_2023"</span> , <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#notice renew_use_2023 has some state names that are lower case</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>renew_use_2023<span class="sc">$</span>State <span class="ot">=</span> <span class="fu">toupper</span>(renew_use_2023<span class="sc">$</span>State)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#convert the usage into numeric values</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>renew_use_2021<span class="sc">$</span>Renewable_Use_2021 <span class="ot">=</span> <span class="fu">as.numeric</span>(renew_use_2021<span class="sc">$</span>Renewable_Use_2021)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>renew_use_2022<span class="sc">$</span>Renewable_Use_2022 <span class="ot">=</span> <span class="fu">as.numeric</span>(renew_use_2022<span class="sc">$</span>Renewable_Use_2022)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>renew_use_2023<span class="sc">$</span>Renewable_Use_2023 <span class="ot">=</span> <span class="fu">as.numeric</span>(renew_use_2023<span class="sc">$</span>Renewable_Use_2023)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="do">## fix registration column name</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ev_registration) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'State'</span>,<span class="st">'EV_Count'</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>ev_registration <span class="ot">=</span> <span class="fu">slice</span>(ev_registration, <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="fu">nrow</span>(ev_registration)))</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>ev_registration <span class="ot">=</span> <span class="fu">extract_digit</span>(ev_registration, <span class="st">"EV_Count"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## make column name easier to reference / slice only necessary rows</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(avg_price) <span class="ot">=</span> <span class="st">"x"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>avg_price <span class="ot">=</span> <span class="fu">slice</span>(avg_price, <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="fu">nrow</span>(avg_price)))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## split up by comma</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>avg_price <span class="ot">=</span> avg_price<span class="sc">|&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        x,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'State'</span>,<span class="st">'2021'</span>,<span class="st">'2022'</span>,<span class="st">'2023'</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">','</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="do">## extract digits only</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>avg_price <span class="ot">=</span> <span class="fu">extract_digit</span>(avg_price, <span class="st">"2021"</span> , <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>avg_price <span class="ot">=</span> <span class="fu">extract_digit</span>(avg_price, <span class="st">"2022"</span> , <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>avg_price <span class="ot">=</span> <span class="fu">extract_digit</span>(avg_price, <span class="st">"2023"</span> , <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>In this section, I renamed all the energy sources so that they are standarized across the renewable energy usage tables and the total energy usage tables. From there, I extracted the data values from avg_price and then organized it into a table. I also extracted numerical values where it was necessary.</li>
</ul>
</section>
<section id="part-3-joining-pivoting-datasets-for-analysis" class="level2">
<h2 class="anchored" data-anchor-id="part-3-joining-pivoting-datasets-for-analysis"><strong>Part 3: Joining / Pivoting Datasets for Analysis</strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## pivot the total use data frames</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>total_use_2021 <span class="ot">=</span> total_use_2021<span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="sc">-</span>Energy_Source,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">'State'</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">'Energy_Use'</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"State"</span>, <span class="fu">everything</span>())</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>total_use_2022 <span class="ot">=</span> total_use_2022<span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="sc">-</span>Energy_Source,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">'State'</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">'Energy_Use'</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">|&gt;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"State"</span>, <span class="fu">everything</span>())</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>total_use_2023 <span class="ot">=</span> total_use_2023<span class="sc">|&gt;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="sc">-</span>Energy_Source,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">'State'</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">'Energy_Use'</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">|&gt;</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"State"</span>, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## join total use data frames and renew use data frames</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>total_energy_use <span class="ot">=</span> total_use_2021 <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        total_use_2022,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'State'</span>, <span class="st">'Energy_Source'</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">''</span>,<span class="st">'_2022'</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        total_use_2023,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'State'</span>,<span class="st">'Energy_Source'</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">''</span>,<span class="st">'_2023'</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Energy_Use_2021'</span> <span class="ot">=</span> Energy_Use</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>renew_energy_use <span class="ot">=</span> renew_use_2021 <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        renew_use_2022,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'State'</span>, <span class="st">'Energy_Source'</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        renew_use_2023,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'State'</span>,<span class="st">'Energy_Source'</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## create growth tables</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## find average growth rate per state per category from 2023-2021</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>renew_growth <span class="ot">=</span> renew_energy_use <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">Average_Growth =</span> ((Renewable_Use_2023 <span class="sc">-</span> Renewable_Use_2021) <span class="sc">/</span> Renewable_Use_2021) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">|&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"State"</span>,<span class="st">"Energy_Source"</span>,<span class="st">"Average_Growth"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>total_growth <span class="ot">=</span> total_energy_use <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="do">## remove the total renewable energy rows for future computatio</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Energy_Source <span class="sc">!=</span> <span class="st">'Total Renewable Energy'</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">Average_Growth =</span> ((Energy_Use_2023 <span class="sc">-</span> Energy_Use_2021) <span class="sc">/</span> Energy_Use_2021) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"State"</span>,<span class="st">"Energy_Source"</span>, <span class="st">"Average_Growth"</span>) </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>summary_function <span class="ot">=</span> <span class="cf">function</span>(df, group, summary_name, user_func){</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">=</span> <span class="fu">match.fun</span>(user_func)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">|&gt;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>({{group}})<span class="sc">|&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            <span class="sc">!!</span>{{summary_name}} <span class="sc">:</span><span class="er">=</span> <span class="fu">f</span>(Average_Growth, <span class="at">na.rm =</span> T)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>total_growth_state <span class="ot">=</span> <span class="fu">summary_function</span>(total_growth, State, <span class="st">"Total Growth (%)"</span>, <span class="st">"sum"</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>total_growth_source <span class="ot">=</span> <span class="fu">summary_function</span>(total_growth, Energy_Source, <span class="st">"Total Growth (%)"</span>, <span class="st">"sum"</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>renew_growth_state <span class="ot">=</span> <span class="fu">summary_function</span>(renew_growth, State, <span class="st">"Total Growth (%)"</span>, <span class="st">"sum"</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>renew_growth_source <span class="ot">=</span> <span class="fu">summary_function</span>(renew_growth, Energy_Source, <span class="st">"Total Growth (%)"</span>, <span class="st">"sum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Here I was focused on combining the renewable energy usage and total energy usage from 2021-2023 into usable data frame. First, I pivoted the data frames so that States became a column. Then I combined them based on energy type, making sure to specify the columns by what year they represented. From there, I created a growth data frame that calculated the average growth per State / Energy Source combination. Finally, that allowed me to group by State and Energy Soure to figure out the energy growths per category from 2021-2023.</li>
</ul>
</section>
<section id="part-4-summary-tables-and-mapping-visualization" class="level2">
<h2 class="anchored" data-anchor-id="part-4-summary-tables-and-mapping-visualization"><strong>Part 4: Summary Tables and Mapping Visualization</strong></h2>
<ul>
<li>Below are the tables that I have created:</li>
</ul>
<p>Table 1: Growth in Non-Renewable Energy Usage by Source (2021-2023)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(total_growth_source, <span class="at">caption =</span> <span class="st">"Growth in Non-Renewable Energy Usage by Source (2021-2023)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Growth in Non-Renewable Energy Usage by Source (2021-2023)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Energy_Source</th>
<th style="text-align: right;">Total Growth (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Coal</td>
<td style="text-align: right;">-1360.34543</td>
</tr>
<tr class="even">
<td style="text-align: left;">Natural Gas</td>
<td style="text-align: right;">295.29370</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nuclear Energy</td>
<td style="text-align: right;">73.08843</td>
</tr>
<tr class="even">
<td style="text-align: left;">Petroleum</td>
<td style="text-align: right;">39.00070</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Table 2: Growth in Renewable Energy Usage by Source (2021-2023)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(renew_growth_source, <span class="at">caption =</span> <span class="st">"Growth in Renewable Energy Usage by Source (2021-2023)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Growth in Renewable Energy Usage by Source (2021-2023)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Energy_Source</th>
<th style="text-align: right;">Total Growth (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Biomass</td>
<td style="text-align: right;">43.364495</td>
</tr>
<tr class="even">
<td style="text-align: left;">Geothermal</td>
<td style="text-align: right;">6.556796</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hydropower</td>
<td style="text-align: right;">-141.648808</td>
</tr>
<tr class="even">
<td style="text-align: left;">Solar Energy</td>
<td style="text-align: right;">4382.719818</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wind Energy</td>
<td style="text-align: right;">50.729189</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Table 3: Growth in Non-Renewable Energy Usage by State (2021-2023)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(total_growth_state, <span class="at">caption =</span> <span class="st">"Growth in Non-Renewable Energy Usage by State (2021-2023)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Growth in Non-Renewable Energy Usage by State (2021-2023)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: right;">Total Growth (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AK</td>
<td style="text-align: right;">15.3335377</td>
</tr>
<tr class="even">
<td style="text-align: left;">AL</td>
<td style="text-align: right;">-26.2887335</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AR</td>
<td style="text-align: right;">4.6795744</td>
</tr>
<tr class="even">
<td style="text-align: left;">AZ</td>
<td style="text-align: right;">-4.5187920</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CA</td>
<td style="text-align: right;">9.9501733</td>
</tr>
<tr class="even">
<td style="text-align: left;">CO</td>
<td style="text-align: right;">-12.5357034</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CT</td>
<td style="text-align: right;">-117.6770231</td>
</tr>
<tr class="even">
<td style="text-align: left;">DC</td>
<td style="text-align: right;">-13.6315781</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DE</td>
<td style="text-align: right;">-93.0978061</td>
</tr>
<tr class="even">
<td style="text-align: left;">FL</td>
<td style="text-align: right;">-23.5758991</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GA</td>
<td style="text-align: right;">5.4385971</td>
</tr>
<tr class="even">
<td style="text-align: left;">HI</td>
<td style="text-align: right;">-72.8621778</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IA</td>
<td style="text-align: right;">-8.4146466</td>
</tr>
<tr class="even">
<td style="text-align: left;">ID</td>
<td style="text-align: right;">-47.7823700</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IL</td>
<td style="text-align: right;">-32.6990407</td>
</tr>
<tr class="even">
<td style="text-align: left;">IN</td>
<td style="text-align: right;">-14.8908290</td>
</tr>
<tr class="odd">
<td style="text-align: left;">KS</td>
<td style="text-align: right;">12.7415467</td>
</tr>
<tr class="even">
<td style="text-align: left;">KY</td>
<td style="text-align: right;">-10.9032213</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LA</td>
<td style="text-align: right;">-69.9289886</td>
</tr>
<tr class="even">
<td style="text-align: left;">MA</td>
<td style="text-align: right;">0.1450114</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MD</td>
<td style="text-align: right;">-55.1038085</td>
</tr>
<tr class="even">
<td style="text-align: left;">ME</td>
<td style="text-align: right;">-3.8021453</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MI</td>
<td style="text-align: right;">-36.5963425</td>
</tr>
<tr class="even">
<td style="text-align: left;">MN</td>
<td style="text-align: right;">-28.7600236</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MO</td>
<td style="text-align: right;">94.8539296</td>
</tr>
<tr class="even">
<td style="text-align: left;">MS</td>
<td style="text-align: right;">-15.4031362</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MT</td>
<td style="text-align: right;">15.1192574</td>
</tr>
<tr class="even">
<td style="text-align: left;">NC</td>
<td style="text-align: right;">-26.7964024</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ND</td>
<td style="text-align: right;">5.8780796</td>
</tr>
<tr class="even">
<td style="text-align: left;">NE</td>
<td style="text-align: right;">-2.2167071</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NH</td>
<td style="text-align: right;">-43.7532779</td>
</tr>
<tr class="even">
<td style="text-align: left;">NJ</td>
<td style="text-align: right;">-90.6266014</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NM</td>
<td style="text-align: right;">-29.8890042</td>
</tr>
<tr class="even">
<td style="text-align: left;">NV</td>
<td style="text-align: right;">-16.2644373</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-14.2138116</td>
</tr>
<tr class="even">
<td style="text-align: left;">OH</td>
<td style="text-align: right;">-25.1648022</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OK</td>
<td style="text-align: right;">-36.6206091</td>
</tr>
<tr class="even">
<td style="text-align: left;">OR</td>
<td style="text-align: right;">-44.2860366</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PA</td>
<td style="text-align: right;">-25.3403566</td>
</tr>
<tr class="even">
<td style="text-align: left;">RI</td>
<td style="text-align: right;">7.1583864</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SC</td>
<td style="text-align: right;">2.3975643</td>
</tr>
<tr class="even">
<td style="text-align: left;">SD</td>
<td style="text-align: right;">2.0214597</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TN</td>
<td style="text-align: right;">-8.2457958</td>
</tr>
<tr class="even">
<td style="text-align: left;">TX</td>
<td style="text-align: right;">-5.1590079</td>
</tr>
<tr class="odd">
<td style="text-align: left;">US</td>
<td style="text-align: right;">-16.2908140</td>
</tr>
<tr class="even">
<td style="text-align: left;">UT</td>
<td style="text-align: right;">-21.4292774</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VA</td>
<td style="text-align: right;">-32.4901718</td>
</tr>
<tr class="even">
<td style="text-align: left;">VT</td>
<td style="text-align: right;">-8.5734979</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WA</td>
<td style="text-align: right;">39.0529408</td>
</tr>
<tr class="even">
<td style="text-align: left;">WI</td>
<td style="text-align: right;">-26.7481084</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WV</td>
<td style="text-align: right;">-12.9377381</td>
</tr>
<tr class="even">
<td style="text-align: left;">WY</td>
<td style="text-align: right;">7.7860674</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Table 4: Growth in Renewable Energy Usage by State (2021-2023)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(renew_growth_state, <span class="at">caption =</span> <span class="st">"Growth in Renewable Energy Usage by State (2021-2023)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Growth in Renewable Energy Usage by State (2021-2023)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: right;">Total Growth (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AK</td>
<td style="text-align: right;">46.104165</td>
</tr>
<tr class="even">
<td style="text-align: left;">AL</td>
<td style="text-align: right;">101.295407</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AR</td>
<td style="text-align: right;">64.362496</td>
</tr>
<tr class="even">
<td style="text-align: left;">AZ</td>
<td style="text-align: right;">31.368129</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CA</td>
<td style="text-align: right;">170.136668</td>
</tr>
<tr class="even">
<td style="text-align: left;">CO</td>
<td style="text-align: right;">92.157052</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CT</td>
<td style="text-align: right;">7.135217</td>
</tr>
<tr class="even">
<td style="text-align: left;">DC</td>
<td style="text-align: right;">43.670696</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DE</td>
<td style="text-align: right;">59.911038</td>
</tr>
<tr class="even">
<td style="text-align: left;">FL</td>
<td style="text-align: right;">10.351794</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GA</td>
<td style="text-align: right;">29.606747</td>
</tr>
<tr class="even">
<td style="text-align: left;">HI</td>
<td style="text-align: right;">-4.979149</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IA</td>
<td style="text-align: right;">102.886630</td>
</tr>
<tr class="even">
<td style="text-align: left;">ID</td>
<td style="text-align: right;">53.189262</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IL</td>
<td style="text-align: right;">99.808974</td>
</tr>
<tr class="even">
<td style="text-align: left;">IN</td>
<td style="text-align: right;">207.073696</td>
</tr>
<tr class="odd">
<td style="text-align: left;">KS</td>
<td style="text-align: right;">17.064276</td>
</tr>
<tr class="even">
<td style="text-align: left;">KY</td>
<td style="text-align: right;">112.850597</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LA</td>
<td style="text-align: right;">9.128716</td>
</tr>
<tr class="even">
<td style="text-align: left;">MA</td>
<td style="text-align: right;">30.579052</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MD</td>
<td style="text-align: right;">19.170273</td>
</tr>
<tr class="even">
<td style="text-align: left;">ME</td>
<td style="text-align: right;">280.479097</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MI</td>
<td style="text-align: right;">134.843928</td>
</tr>
<tr class="even">
<td style="text-align: left;">MN</td>
<td style="text-align: right;">43.119664</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MO</td>
<td style="text-align: right;">11.445482</td>
</tr>
<tr class="even">
<td style="text-align: left;">MS</td>
<td style="text-align: right;">48.911768</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MT</td>
<td style="text-align: right;">324.553597</td>
</tr>
<tr class="even">
<td style="text-align: left;">NC</td>
<td style="text-align: right;">-16.684436</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ND</td>
<td style="text-align: right;">38.613264</td>
</tr>
<tr class="even">
<td style="text-align: left;">NE</td>
<td style="text-align: right;">69.213835</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NH</td>
<td style="text-align: right;">80.738949</td>
</tr>
<tr class="even">
<td style="text-align: left;">NJ</td>
<td style="text-align: right;">-23.029681</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NM</td>
<td style="text-align: right;">65.488663</td>
</tr>
<tr class="even">
<td style="text-align: left;">NV</td>
<td style="text-align: right;">5.813501</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NY</td>
<td style="text-align: right;">69.154687</td>
</tr>
<tr class="even">
<td style="text-align: left;">OH</td>
<td style="text-align: right;">81.011815</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OK</td>
<td style="text-align: right;">45.760389</td>
</tr>
<tr class="even">
<td style="text-align: left;">OR</td>
<td style="text-align: right;">34.965118</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PA</td>
<td style="text-align: right;">27.887750</td>
</tr>
<tr class="even">
<td style="text-align: left;">RI</td>
<td style="text-align: right;">129.977380</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SC</td>
<td style="text-align: right;">8.292119</td>
</tr>
<tr class="even">
<td style="text-align: left;">SD</td>
<td style="text-align: right;">819.855175</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TN</td>
<td style="text-align: right;">57.538843</td>
</tr>
<tr class="even">
<td style="text-align: left;">TX</td>
<td style="text-align: right;">84.296415</td>
</tr>
<tr class="odd">
<td style="text-align: left;">US</td>
<td style="text-align: right;">53.721495</td>
</tr>
<tr class="even">
<td style="text-align: left;">UT</td>
<td style="text-align: right;">65.619648</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VA</td>
<td style="text-align: right;">69.175567</td>
</tr>
<tr class="even">
<td style="text-align: left;">VT</td>
<td style="text-align: right;">52.915192</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WA</td>
<td style="text-align: right;">107.763745</td>
</tr>
<tr class="even">
<td style="text-align: left;">WI</td>
<td style="text-align: right;">163.635492</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WV</td>
<td style="text-align: right;">90.092103</td>
</tr>
<tr class="even">
<td style="text-align: left;">WY</td>
<td style="text-align: right;">13.679190</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grab centeroid per state</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>state_polys <span class="ot">=</span> <span class="fu">us_map</span>(<span class="st">"states"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the centroid values to an sf object (something called a CRS system)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state_sf <span class="ot">=</span> <span class="fu">st_as_sf</span>(state_polys)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># compute centroids of each state's polygon</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>state_centroids <span class="ot">&lt;-</span> state_sf <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>() <span class="sc">|&gt;</span> <span class="co"># transforms into point from polygons</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">|&gt;</span> <span class="co">#transform the CRS values into Long and Lat</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co">#grab long and lat</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geom)[,<span class="dv">1</span>],</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geom)[,<span class="dv">2</span>]</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> <span class="co"># drops the original CRS column</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(abbr, lon, lat) <span class="sc">|&gt;</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">State =</span> abbr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># at this stage, state_centroids is a data frame with state name lon and lat</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with renewable energy growth table</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>renew_growth_map <span class="ot">=</span> <span class="fu">left_join</span>(renew_growth_state, state_centroids, <span class="at">by =</span> <span class="st">"State"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add color and size column</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>renew_growth_map <span class="ot">=</span> renew_growth_map <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Total Growth (%)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="fu">abs</span>(<span class="st">`</span><span class="at">Total Growth (%)</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">500</span>  <span class="co"># 500 seems the most visible</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># create leaflet map</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(renew_growth_map) <span class="sc">|&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"CartoDB.Positron"</span>) <span class="sc">|&gt;</span> <span class="co">#cartoDB.Positron is just like the background map we use as base</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircles</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="sc">~</span>lon,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="sc">~</span>lat,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="sc">~</span>radius,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>color,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillColor =</span> <span class="sc">~</span>color,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.6</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;"</span>, State, <span class="st">"&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Growth: "</span>, <span class="fu">round</span>(<span class="st">`</span><span class="at">Total Growth (%)</span><span class="st">`</span>, <span class="dv">2</span>), <span class="st">"%"</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="co"># add pop up for when you hover above the circle</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Positive Growth"</span>, <span class="st">"Negative Growth"</span>),</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Renewable Energy Growth (2021â€“2023)"</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in validateCoords(lng, lat, funcName): Data contains 1 rows with either
missing or invalid lat/lon values and will be ignored</code></pre>
</div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-249cea8168720f79b455" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-249cea8168720f79b455">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircles","args":[[26.19346090590556,32.77764476056513,34.89558757236382,34.27797001588539,37.19085383728265,38.99921156927756,41.61907419596972,38.90417362204837,38.99864335038713,28.5857979576847,32.63863091413814,26.01460322849123,42.07600280718292,44.35305714533155,40.04104917007349,39.89445974286803,38.49625035394007,37.53650854146242,31.01510838602099,42.2379442770627,39.02895988556424,45.33139295599271,44.34086652287303,46.28205636808806,38.35855610224201,32.73736572350232,47.05233604149798,35.55651024813489,47.44961331135433,41.53914260134004,43.67957899218867,40.18045633640433,34.41070109314503,39.3318954650432,42.93531541478608,40.29198850383423,35.59214325538389,43.93585499883834,40.87970645896091,41.66217913643129,33.90735228439161,44.44445852783766,35.86182307565484,31.45367229413653,null,39.30721327512317,37.52102072399618,44.06911977659153,47.3917415592844,44.62578275059039,38.64353904837296,42.99657049130914],[-115.7054374294862,-86.8321758471461,-92.44261862882396,-111.6566240376745,-119.4532207157868,-105.5462698840473,-72.72815917946092,-77.01655085827042,-75.50025337824003,-82.45629081818697,-83.43533175038665,-104.3231698963462,-93.49558440293166,-114.6063698783328,-89.19803439481312,-86.28272563496073,-98.37759191532125,-85.30207536955454,-91.93255321843939,-71.75620455262491,-76.74349253788893,-69.22919428152589,-85.38630197144663,-94.30457044778593,-92.45960372560126,-89.66649666565336,-109.6275899025811,-79.18341322953977,-100.4653177782497,-99.79426508981027,-71.58106119853274,-74.66400904966062,-106.1109206583738,-116.6251409739815,-75.50638139304584,-82.79741626693956,-97.4942651813832,-120.5580229711848,-77.80141854414289,-71.53204032643276,-80.89033046968527,-100.226972233242,-86.34968383603028,-99.30200656906025,null,-111.667049417826,-78.8003457625309,-72.66706484202896,-120.4942447556957,-89.99338821655728,-80.62314380449797,-107.5493947331164],[23052.08233089703,50647.70340596667,32181.2479534925,15684.06463493385,85068.33387188143,46078.52593701247,3567.608235815873,21835.34788064178,29955.51894894021,5175.897117428483,14803.37364228452,2489.574458254961,51443.31485073346,26594.63122932159,49904.48706341351,103536.8480409864,8532.137978380699,56425.29872184647,4564.35816019831,15289.52614886314,9585.13644476401,140239.5483309618,67421.96391306887,21559.83207001248,5722.740958914327,24455.88420721902,162276.7985481772,8342.217844493791,19306.63194889074,34606.91761615452,40369.47448364985,11514.84075289134,32744.33146651246,2906.750554861445,34577.34368996372,40505.90732502388,22880.19437741219,17482.55909969096,13943.87518505065,64988.68992510168,4146.059444677858,409927.5874670955,28769.42147448705,42148.2077111203,26860.74755014578,32809.82407351417,34587.78332818935,26457.59618936665,53881.87239832681,81817.74615925332,45046.05139134943,6839.595167884922],null,null,{"interactive":true,"className":"","stroke":true,"color":["blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","red","blue","blue","blue","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"],"weight":5,"opacity":0.5,"fill":true,"fillColor":["blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","red","blue","blue","blue","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"],"fillOpacity":0.6},["<b>AK<\/b><br>Growth: 46.1%","<b>AL<\/b><br>Growth: 101.3%","<b>AR<\/b><br>Growth: 64.36%","<b>AZ<\/b><br>Growth: 31.37%","<b>CA<\/b><br>Growth: 170.14%","<b>CO<\/b><br>Growth: 92.16%","<b>CT<\/b><br>Growth: 7.14%","<b>DC<\/b><br>Growth: 43.67%","<b>DE<\/b><br>Growth: 59.91%","<b>FL<\/b><br>Growth: 10.35%","<b>GA<\/b><br>Growth: 29.61%","<b>HI<\/b><br>Growth: -4.98%","<b>IA<\/b><br>Growth: 102.89%","<b>ID<\/b><br>Growth: 53.19%","<b>IL<\/b><br>Growth: 99.81%","<b>IN<\/b><br>Growth: 207.07%","<b>KS<\/b><br>Growth: 17.06%","<b>KY<\/b><br>Growth: 112.85%","<b>LA<\/b><br>Growth: 9.13%","<b>MA<\/b><br>Growth: 30.58%","<b>MD<\/b><br>Growth: 19.17%","<b>ME<\/b><br>Growth: 280.48%","<b>MI<\/b><br>Growth: 134.84%","<b>MN<\/b><br>Growth: 43.12%","<b>MO<\/b><br>Growth: 11.45%","<b>MS<\/b><br>Growth: 48.91%","<b>MT<\/b><br>Growth: 324.55%","<b>NC<\/b><br>Growth: -16.68%","<b>ND<\/b><br>Growth: 38.61%","<b>NE<\/b><br>Growth: 69.21%","<b>NH<\/b><br>Growth: 80.74%","<b>NJ<\/b><br>Growth: -23.03%","<b>NM<\/b><br>Growth: 65.49%","<b>NV<\/b><br>Growth: 5.81%","<b>NY<\/b><br>Growth: 69.15%","<b>OH<\/b><br>Growth: 81.01%","<b>OK<\/b><br>Growth: 45.76%","<b>OR<\/b><br>Growth: 34.97%","<b>PA<\/b><br>Growth: 27.89%","<b>RI<\/b><br>Growth: 129.98%","<b>SC<\/b><br>Growth: 8.29%","<b>SD<\/b><br>Growth: 819.86%","<b>TN<\/b><br>Growth: 57.54%","<b>TX<\/b><br>Growth: 84.3%","<b>US<\/b><br>Growth: 53.72%","<b>UT<\/b><br>Growth: 65.62%","<b>VA<\/b><br>Growth: 69.18%","<b>VT<\/b><br>Growth: 52.92%","<b>WA<\/b><br>Growth: 107.76%","<b>WI<\/b><br>Growth: 163.64%","<b>WV<\/b><br>Growth: 90.09%","<b>WY<\/b><br>Growth: 13.68%"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]},{"method":"addLegend","args":[{"colors":["blue","red"],"labels":["Positive Growth","Negative Growth"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"bottomright","type":"unknown","title":"Renewable Energy Growth (2021â€“2023)","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[26.01460322849123,47.44961331135433],"lng":[-120.5580229711848,-69.22919428152589]}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge with non-renewable energy growth table</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>total_growth_map <span class="ot">=</span> <span class="fu">left_join</span>(total_growth_state, state_centroids, <span class="at">by =</span> <span class="st">"State"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Total Growth (%)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">radius =</span> <span class="fu">abs</span>(<span class="st">`</span><span class="at">Total Growth (%)</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">1000</span>  <span class="co"># adjust to 1000 since different scales</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create leaflet map</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(total_growth_map) <span class="sc">|&gt;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"CartoDB.Positron"</span>) <span class="sc">|&gt;</span> <span class="co">#cartoDB.Positron is just like the background map we use as base</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircles</span>(</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="sc">~</span>lon,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="sc">~</span>lat,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="sc">~</span>radius,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>color,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillColor =</span> <span class="sc">~</span>color,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.6</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;"</span>, State, <span class="st">"&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Growth: "</span>, <span class="fu">round</span>(<span class="st">`</span><span class="at">Total Growth (%)</span><span class="st">`</span>, <span class="dv">2</span>), <span class="st">"%"</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="co"># add pop up for when you hover above the circle</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Positive Growth"</span>, <span class="st">"Negative Growth"</span>),</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Non-Renewable Energy Growth (2021â€“2023)"</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in validateCoords(lng, lat, funcName): Data contains 1 rows with either
missing or invalid lat/lon values and will be ignored</code></pre>
</div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-e428413c800c1f545b8e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e428413c800c1f545b8e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircles","args":[[26.19346090590556,32.77764476056513,34.89558757236382,34.27797001588539,37.19085383728265,38.99921156927756,41.61907419596972,38.90417362204837,38.99864335038713,28.5857979576847,32.63863091413814,26.01460322849123,42.07600280718292,44.35305714533155,40.04104917007349,39.89445974286803,38.49625035394007,37.53650854146242,31.01510838602099,42.2379442770627,39.02895988556424,45.33139295599271,44.34086652287303,46.28205636808806,38.35855610224201,32.73736572350232,47.05233604149798,35.55651024813489,47.44961331135433,41.53914260134004,43.67957899218867,40.18045633640433,34.41070109314503,39.3318954650432,42.93531541478608,40.29198850383423,35.59214325538389,43.93585499883834,40.87970645896091,41.66217913643129,33.90735228439161,44.44445852783766,35.86182307565484,31.45367229413653,null,39.30721327512317,37.52102072399618,44.06911977659153,47.3917415592844,44.62578275059039,38.64353904837296,42.99657049130914],[-115.7054374294862,-86.8321758471461,-92.44261862882396,-111.6566240376745,-119.4532207157868,-105.5462698840473,-72.72815917946092,-77.01655085827042,-75.50025337824003,-82.45629081818697,-83.43533175038665,-104.3231698963462,-93.49558440293166,-114.6063698783328,-89.19803439481312,-86.28272563496073,-98.37759191532125,-85.30207536955454,-91.93255321843939,-71.75620455262491,-76.74349253788893,-69.22919428152589,-85.38630197144663,-94.30457044778593,-92.45960372560126,-89.66649666565336,-109.6275899025811,-79.18341322953977,-100.4653177782497,-99.79426508981027,-71.58106119853274,-74.66400904966062,-106.1109206583738,-116.6251409739815,-75.50638139304584,-82.79741626693956,-97.4942651813832,-120.5580229711848,-77.80141854414289,-71.53204032643276,-80.89033046968527,-100.226972233242,-86.34968383603028,-99.30200656906025,null,-111.667049417826,-78.8003457625309,-72.66706484202896,-120.4942447556957,-89.99338821655728,-80.62314380449797,-107.5493947331164],[15333.53765458158,26288.73350493366,4679.574396767156,4518.792048837708,9950.17326341869,12535.70340164507,117677.0230980843,13631.57806736752,93097.8061358854,23575.89912802412,5438.59709476321,72862.17777487384,8414.646562315689,47782.37001420459,32699.04068484743,14890.82902041889,12741.54671059788,10903.22125308924,69928.98856535413,145.0114182168969,55103.80849239652,3802.145282660118,36596.34254413591,28760.02355270868,94853.92962739538,15403.13616639646,15119.25736809974,26796.40238934462,5878.079603723046,2216.707120881352,43753.27792055919,90626.60137867116,29889.00419980328,16264.43729569623,14213.81155159536,25164.80217488527,36620.60914977002,44286.03657752416,25340.35656133256,7158.386350762464,2397.564332661063,2021.459672221254,8245.79582144927,5159.007867638552,16290.81401227887,21429.27740148193,32490.17182142654,8573.497889149814,39052.9408249734,26748.10838588753,12937.73807184554,7786.067413405014],null,null,{"interactive":true,"className":"","stroke":true,"color":["blue","red","blue","red","blue","red","red","red","red","red","blue","red","red","red","red","red","blue","red","red","blue","red","red","red","red","blue","red","blue","red","blue","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","red","red","red","red","red","red","blue","red","red","blue"],"weight":5,"opacity":0.5,"fill":true,"fillColor":["blue","red","blue","red","blue","red","red","red","red","red","blue","red","red","red","red","red","blue","red","red","blue","red","red","red","red","blue","red","blue","red","blue","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","red","red","red","red","red","red","blue","red","red","blue"],"fillOpacity":0.6},["<b>AK<\/b><br>Growth: 15.33%","<b>AL<\/b><br>Growth: -26.29%","<b>AR<\/b><br>Growth: 4.68%","<b>AZ<\/b><br>Growth: -4.52%","<b>CA<\/b><br>Growth: 9.95%","<b>CO<\/b><br>Growth: -12.54%","<b>CT<\/b><br>Growth: -117.68%","<b>DC<\/b><br>Growth: -13.63%","<b>DE<\/b><br>Growth: -93.1%","<b>FL<\/b><br>Growth: -23.58%","<b>GA<\/b><br>Growth: 5.44%","<b>HI<\/b><br>Growth: -72.86%","<b>IA<\/b><br>Growth: -8.41%","<b>ID<\/b><br>Growth: -47.78%","<b>IL<\/b><br>Growth: -32.7%","<b>IN<\/b><br>Growth: -14.89%","<b>KS<\/b><br>Growth: 12.74%","<b>KY<\/b><br>Growth: -10.9%","<b>LA<\/b><br>Growth: -69.93%","<b>MA<\/b><br>Growth: 0.15%","<b>MD<\/b><br>Growth: -55.1%","<b>ME<\/b><br>Growth: -3.8%","<b>MI<\/b><br>Growth: -36.6%","<b>MN<\/b><br>Growth: -28.76%","<b>MO<\/b><br>Growth: 94.85%","<b>MS<\/b><br>Growth: -15.4%","<b>MT<\/b><br>Growth: 15.12%","<b>NC<\/b><br>Growth: -26.8%","<b>ND<\/b><br>Growth: 5.88%","<b>NE<\/b><br>Growth: -2.22%","<b>NH<\/b><br>Growth: -43.75%","<b>NJ<\/b><br>Growth: -90.63%","<b>NM<\/b><br>Growth: -29.89%","<b>NV<\/b><br>Growth: -16.26%","<b>NY<\/b><br>Growth: -14.21%","<b>OH<\/b><br>Growth: -25.16%","<b>OK<\/b><br>Growth: -36.62%","<b>OR<\/b><br>Growth: -44.29%","<b>PA<\/b><br>Growth: -25.34%","<b>RI<\/b><br>Growth: 7.16%","<b>SC<\/b><br>Growth: 2.4%","<b>SD<\/b><br>Growth: 2.02%","<b>TN<\/b><br>Growth: -8.25%","<b>TX<\/b><br>Growth: -5.16%","<b>US<\/b><br>Growth: -16.29%","<b>UT<\/b><br>Growth: -21.43%","<b>VA<\/b><br>Growth: -32.49%","<b>VT<\/b><br>Growth: -8.57%","<b>WA<\/b><br>Growth: 39.05%","<b>WI<\/b><br>Growth: -26.75%","<b>WV<\/b><br>Growth: -12.94%","<b>WY<\/b><br>Growth: 7.79%"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]},{"method":"addLegend","args":[{"colors":["blue","red"],"labels":["Positive Growth","Negative Growth"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"bottomright","type":"unknown","title":"Non-Renewable Energy Growth (2021â€“2023)","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[26.01460322849123,47.44961331135433],"lng":[-120.5580229711848,-69.22919428152589]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="part-5-analysis" class="level2">
<h2 class="anchored" data-anchor-id="part-5-analysis"><strong>Part 5: Analysis</strong></h2>
<ul>
<li><p>Overall, we can see that the nationwide trend has been to increase Renewable Energy Usage while decreasing Non-Renewable Usage.</p></li>
<li><p>Furthermore, when looking at the growths by Sourced, we can see that the greatest decrease in usage was coal at -1360% while the greatest increase in usage was Solar Energy at 4382%.</p></li>
<li><p>The state with the greatest increase in Renewable Energy Usage was South Dakota at 819.86%.</p></li>
<li><p>The state with the greatest increase in Non-Renewable Energy Usage was Montana at 94.85%.</p></li>
<li><p>The state with the greatest decrease in Non-Renewable Energy Usage was Connecticut at -117.68%.</p></li>
<li><p>We can see that the Map helps out a lot visually with our main questions when it comes to state groupings. Itâ€™s easy to see the states with the largest growth and with the color coding which highlights negative growth, itâ€™s easy to tell the trend of growth between Renewable Energy Growth and Non-Renewable Energy Growth</p></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>